<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Malla Interactiva - Plan por Año en Columnas</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #fafafa;
      margin: 0; padding: 25px;
      color: #0b2e7f;
      user-select: none;
      overflow-x: hidden;
    }
    h1 {
      text-align: center;
      margin-bottom: 35px;
      color: #0b3d91;
      font-weight: 700;
      letter-spacing: 1.5px;
    }

    /* Contenedor principal: fila horizontal con scroll */
    #planEstudios {
      display: flex;
      gap: 25px;
      justify-content: flex-start;
      flex-wrap: nowrap;
      overflow-x: auto;
      padding-bottom: 15px;

      scrollbar-width: thin;
      scrollbar-color: #2853c8 #dcdcdc;
    }
    #planEstudios::-webkit-scrollbar {
      height: 10px;
    }
    #planEstudios::-webkit-scrollbar-track {
      background: #dcdcdc;
      border-radius: 10px;
    }
    #planEstudios::-webkit-scrollbar-thumb {
      background-color: #2853c8;
      border-radius: 10px;
    }

    /* Cada columna año */
    .year-container {
      border: 2.5px solid #2853c8;
      border-radius: 10px;
      padding: 10px 10px 15px 10px;
      background: #ffffff;
      box-shadow: 3px 4px 10px #b0b8d8aa;
      min-width: 170px;

      /* Quité max-height para que no limite la altura y se vean todas las materias */
      /* max-height: 80vh; */
      /* overflow-y: auto; */

      display: flex;
      flex-direction: column;
      align-items: center;
      flex-shrink: 0; /* importante que no se achique para que se vean todos los años */
    }

    /* Título del año con fondo azul */
    .year-title {
      font-size: 1.8em;
      margin-bottom: 15px;
      padding: 8px 12px;
      font-weight: 700;
      color: white;
      background: linear-gradient(135deg, #3a57a9, #597bd1);
      border-radius: 8px;
      width: 100%;
      text-align: center;
      user-select: text;
      box-shadow: 0 0 8px #3a57a9aa;
      white-space: nowrap;
    }

    /* Contenedor para materias sin límite de altura */
    .materias-list {
      width: 100%;
      /* Quité scroll vertical para mostrar todo */
      /* overflow-y: auto; */
      /* max-height: calc(80vh - 70px); */
      padding-right: 5px;
    }

    /* Materias */
    .subject {
      background: #d3dbff;
      margin: 6px 0;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      border: 2px solid #3a57a9;
      width: 100%;
      text-align: center;
      font-weight: 600;
      color: #1a2e8f;
      box-shadow: 1px 2px 6px #2e4eb7aa;
      transition:
        background-color 0.3s ease,
        color 0.3s ease,
        box-shadow 0.3s ease,
        transform 0.15s ease;
      user-select: none;
      font-size: 0.9em;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .subject:hover:not(.disabled):not(.completed) {
      background-color: #a3b6ff;
      color: #102f72;
      box-shadow: 2px 4px 10px #2444a9cc;
      transform: translateY(-2px);
    }
    .subject.disabled {
      cursor: not-allowed;
      opacity: 0.5;
      background: #9daae4;
      border-color: #7b8bc1;
      color: #555d8f;
      box-shadow: none;
      text-decoration: none !important;
    }
    .subject.completed {
      text-decoration: line-through;
      background: #2946ad;
      color: white;
      border-color: #1d2f6a;
      box-shadow: 1px 2px 8px #112255cc;
    }
  </style>
</head>
<body>
  <h1>Malla Interactiva - Plan por Año en Columnas</h1>

  <div id="planEstudios"></div>

  <script>
    const materias = [
      // Ejemplo ampliado para probar varias materias y años
      { id: 'mat1', nombre: 'Introducción a la Ingeniería', año: 1, correlativas: [] },
      { id: 'mat2', nombre: 'Química I', año: 1, correlativas: [] },
      { id: 'mat3', nombre: 'Complementos de Matemáticas', año: 1, correlativas: [] },
      { id: 'mat4', nombre: 'Cálculo Elemental', año: 1, correlativas: ['mat3'] },
      { id: 'mat5', nombre: 'Informática General', año: 1, correlativas: [] },

      { id: 'mat6', nombre: 'Química II', año: 2, correlativas: ['mat2'] },
      { id: 'mat7', nombre: 'Álgebra y Geometría', año: 2, correlativas: ['mat3'] },
      { id: 'mat8', nombre: 'Representación Gráfica Digital', año: 2, correlativas: [] },
      { id: 'mat9', nombre: 'Física I', año: 2, correlativas: ['mat4'] },
      { id: 'mat10', nombre: 'Electrónica Básica', año: 2, correlativas: [] },

      { id: 'mat11', nombre: 'Física II', año: 3, correlativas: ['mat9'] },
      { id: 'mat12', nombre: 'Matemática Superior', año: 3, correlativas: ['mat7'] },
      { id: 'mat13', nombre: 'Termodinámica', año: 3, correlativas: ['mat6'] },
      { id: 'mat14', nombre: 'Programación Avanzada', año: 3, correlativas: ['mat5'] },

      { id: 'mat15', nombre: 'Proyectos Finales', año: 4, correlativas: ['mat12', 'mat13'] },
      { id: 'mat16', nombre: 'Investigación Aplicada', año: 4, correlativas: ['mat14'] },
    ];

    const años = [...new Set(materias.map(m => m.año))].sort();

    const estadoGuardado = JSON.parse(localStorage.getItem('estadoMaterias')) || {};

    const planDiv = document.getElementById('planEstudios');

    function estaHabilitada(materia) {
      if (materia.correlativas.length === 0) return true;
      return materia.correlativas.every(idCorrelativa => estadoGuardado[idCorrelativa] === true);
    }

    function renderizarMaterias() {
      planDiv.innerHTML = '';

      años.forEach(año => {
        const contenedorAño = document.createElement('div');
        contenedorAño.classList.add('year-container');

        // Título azul del año
        const tituloAño = document.createElement('h2');
        tituloAño.classList.add('year-title');
        tituloAño.textContent = `${año}° Año`;
        contenedorAño.appendChild(tituloAño);

        // Lista materias SIN scroll vertical para mostrar todo
        const listaMaterias = document.createElement('div');
        listaMaterias.classList.add('materias-list');

        const materiasDelAño = materias.filter(m => m.año === año);

        materiasDelAño.forEach(materia => {
          const divMateria = document.createElement('div');
          divMateria.classList.add('subject');
          divMateria.id = materia.id;
          divMateria.textContent = materia.nombre;

          const habilitada = estaHabilitada(materia);
          if (!habilitada) {
            divMateria.classList.add('disabled');
          }

          if (estadoGuardado[materia.id]) {
            divMateria.classList.add('completed');
          }

          divMateria.addEventListener('click', () => {
            if (!estaHabilitada(materia)) return;

            estadoGuardado[materia.id] = !estadoGuardado[materia.id];
            localStorage.setItem('estadoMaterias', JSON.stringify(estadoGuardado));
            renderizarMaterias();
          });

          listaMaterias.appendChild(divMateria);
        });

        contenedorAño.appendChild(listaMaterias);
        planDiv.appendChild(contenedorAño);
      });
    }

    renderizarMaterias();
  </script>
</body>
</html>

